var handler = StripeCheckout.configure({
  key: "<%= ENV['STRIPE_PUBLIC_KEY'] %>",
  image: "<%= asset_url('logo-beta.png') %>",
  locale: 'auto',
  name: 'SpaceSkout',
  description: "Subscription to <%= @coupon_form.plan.name.capitalize %> plan",
  token: function(token) {
    $.ajax({
      type: "POST",
      url: "<%= dashboard_plan_subscriptions_path(@coupon_form.plan.id) %>",
      data: {
        stripe_token: token.id,
        coupon_code: '<%= @coupon_form.coupon_code %>'
      },
      success: function() {
        window.location = "<%= dashboard_spaces_path %>"
      },
      error: function() {
        alert("The charge wasn's successful. Please try again");
      },
      dataType: 'json'
    });
  }
});
handler.open({});
